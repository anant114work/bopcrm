{% extends 'leads/base_unified.html' %}
{% load lead_filters %}

{% block title %}All Leads - CRM{% endblock %}
{% block page_title %}All Leads{% endblock %}

{% block content %}
<div class="card">
    <div class="d-flex">
        <input type="text" placeholder="Search leads..." value="{{ search|default:'' }}" style="flex: 1; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px;">
        <select style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px;">
            <option value="">All Forms</option>
            {% for form in forms %}
            <option value="{{ form }}" {% if form_filter == form %}selected{% endif %}>{{ form }}</option>
            {% endfor %}
        </select>
        <button class="btn btn-primary">Search</button>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Contact</th>
                <th>Stage</th>
                <th>Assigned To</th>
                <th>Form</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for lead in leads %}
            <tr>
                <td>
                    <div>
                        <a href="/leads/{{ lead.id }}/" style="font-weight: 600; color: #1e293b; text-decoration: none;">
                            {{ lead.full_name|default:"No Name" }}
                        </a>
                        {% if lead.budget %}
                        <div class="text-muted">
                            Budget: {{ lead.budget }}
                        </div>
                        {% endif %}
                    </div>
                </td>
                <td>
                    <div>
                        <div style="margin-bottom: 4px;">
                            <a href="tel:{{ lead.phone_number }}" class="small">
                                {% maskable_number lead.phone_number "phone" %}
                            </a>
                        </div>
                        {% if lead.email %}
                        <div>
                            <a href="mailto:{{ lead.email }}" class="small">
                                {{ lead.email }}
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </td>
                <td>
                    <span class="stage-badge stage-{{ lead.stage }}" style="padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; background: #dbeafe; color: #1e40af;">
                        {{ lead.stage|title }}
                    </span>
                </td>
                <td>
                    {% if lead.assigned_to %}
                        {{ lead.assigned_to.name }}
                    {% else %}
                        <span class="text-muted">Unassigned</span>
                    {% endif %}
                </td>
                <td>
                    <span class="text-muted">
                        {{ lead.form_name|truncatechars:25 }}
                    </span>
                </td>
                <td>
                    <div class="text-muted">
                        {{ lead.created_time|date:"M d, Y" }}<br>
                        <span style="font-size: 11px;">{{ lead.created_time|date:"H:i" }}</span>
                    </div>
                </td>
                <td>
                    <a href="/leads/{{ lead.id }}/" class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        View
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center">
                    <div style="font-size: 18px; margin-bottom: 8px;">No leads found</div>
                    <div class="small">Try adjusting your filters or sync new leads</div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if leads.has_other_pages %}
    <div class="pagination">
        {% if leads.has_previous %}
            <a href="?page=1{% if search %}&search={{ search }}{% endif %}{% if form_filter %}&form={{ form_filter }}{% endif %}">« First</a>
            <a href="?page={{ leads.previous_page_number }}{% if search %}&search={{ search }}{% endif %}{% if form_filter %}&form={{ form_filter }}{% endif %}">‹ Previous</a>
        {% endif %}
        
        <span class="current">Page {{ leads.number }} of {{ leads.paginator.num_pages }}</span>
        
        {% if leads.has_next %}
            <a href="?page={{ leads.next_page_number }}{% if search %}&search={{ search }}{% endif %}{% if form_filter %}&form={{ form_filter }}{% endif %}">Next ›</a>
            <a href="?page={{ leads.paginator.num_pages }}{% if search %}&search={{ search }}{% endif %}{% if form_filter %}&form={{ form_filter }}{% endif %}">Last »</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    function toggleMask(element) {
        const isCurrentlyMasked = element.textContent === element.dataset.masked;
        element.textContent = isCurrentlyMasked ? element.dataset.original : element.dataset.masked;
        element.style.color = isCurrentlyMasked ? '#10b981' : '#6b7280';
    }
</script>
{% endblock %}