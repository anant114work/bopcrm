{% extends 'leads/base_unified.html' %}

{% block title %}{{ team_member.name }} - Profile{% endblock %}
{% block page_title %}My Profile{% endblock %}



{% block content %}
<!-- Profile Navigation Tabs -->
<div class="profile-tabs">
    <div class="profile-tab active" onclick="showTab('profile')">Profile</div>
    <div class="profile-tab" onclick="showTab('hrms')">HRMS</div>
    <div class="profile-tab" onclick="showTab('attendance')">Attendance</div>
    <div class="profile-tab" onclick="showTab('leaves')">Leave Management</div>
</div>

<!-- Profile Tab -->
<div id="profile" class="tab-content active">
    <div class="card">
        <div class="card-header">
            <h2>Profile Information</h2>
        </div>
        <div class="card-content">
            <div class="profile-avatar">
                {{ team_member.name|first|upper }}
            </div>
            
            <form method="post" action="/team/profile/">
                {% csrf_token %}
                <div class="form-grid">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" name="name" value="{{ team_member.name }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" name="email" value="{{ team_member.email }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" name="phone" value="{{ team_member.phone }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Role</label>
                        <input type="text" value="{{ team_member.role }}" disabled>
                    </div>
                    
                    <div class="form-group">
                        <label>Employee ID</label>
                        <input type="text" value="EMP{{ team_member.id|stringformat:'04d' }}" disabled>
                    </div>
                    
                    <div class="form-group">
                        <label>Department</label>
                        <input type="text" value="Sales" disabled>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">Update Profile</button>
            </form>
        </div>
    </div>
    
    <!-- Performance Stats -->
    <div class="card">
        <div class="card-header">
            <h2>Performance Overview</h2>
        </div>
        <div class="card-content">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">{{ stats.total_assigned|default:0 }}</div>
                    <div class="stat-label">Total Assigned</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ stats.completed|default:0 }}</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ stats.pending|default:0 }}</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ stats.conversion_rate|default:0 }}%</div>
                    <div class="stat-label">Conversion Rate</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- HRMS Tab -->
<div id="hrms" class="tab-content">
    <div class="card">
        <div class="card-header">
            <h2>Employee Information</h2>
        </div>
        <div class="card-content">
            <div class="form-grid">
                <div class="form-group">
                    <label>Employee ID</label>
                    <input type="text" value="EMP{{ team_member.id|stringformat:'04d' }}" disabled>
                </div>
                
                <div class="form-group">
                    <label>Joining Date</label>
                    <input type="date" value="{{ team_member.created_at|date:'Y-m-d' }}" disabled>
                </div>
                
                <div class="form-group">
                    <label>Department</label>
                    <input type="text" value="Sales Department" disabled>
                </div>
                
                <div class="form-group">
                    <label>Designation</label>
                    <input type="text" value="{{ team_member.role }}" disabled>
                </div>
                
                <div class="form-group">
                    <label>Reporting Manager</label>
                    <input type="text" value="{% if team_member.parent_user %}{{ team_member.parent_user.name }}{% else %}N/A{% endif %}" disabled>
                </div>
                
                <div class="form-group">
                    <label>Employment Type</label>
                    <input type="text" value="Full Time" disabled>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h2>Personal Information</h2>
        </div>
        <div class="card-content">
            <form method="post" action="/team/update-personal-info/">
                {% csrf_token %}
                <div class="form-grid">
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" name="date_of_birth" value="{{ hrms_data.date_of_birth|date:'Y-m-d' }}">
                    </div>
                    
                    <div class="form-group">
                        <label>Gender</label>
                        <select name="gender">
                            <option value="">Select Gender</option>
                            <option value="Male" {% if hrms_data.gender == 'Male' %}selected{% endif %}>Male</option>
                            <option value="Female" {% if hrms_data.gender == 'Female' %}selected{% endif %}>Female</option>
                            <option value="Other" {% if hrms_data.gender == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Emergency Contact</label>
                        <input type="tel" name="emergency_contact" value="{{ hrms_data.emergency_contact }}" placeholder="Emergency contact number">
                    </div>
                    
                    <div class="form-group">
                        <label>Address</label>
                        <textarea name="address" rows="3" placeholder="Current address">{{ hrms_data.address }}</textarea>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">Update Information</button>
            </form>
        </div>
    </div>
</div>

<!-- Attendance Tab -->
<div id="attendance" class="tab-content">
    <div class="card">
        <div class="card-header">
            <h2>Attendance Overview</h2>
        </div>
        <div class="card-content">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">22</div>
                    <div class="stat-label">Present Days</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">3</div>
                    <div class="stat-label">Absent Days</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">2</div>
                    <div class="stat-label">Late Arrivals</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">88%</div>
                    <div class="stat-label">Attendance Rate</div>
                </div>
            </div>
            
            <h3 style="margin: 24px 0 16px;">Monthly Attendance</h3>
            <div class="attendance-calendar" id="attendanceCalendar">
                <!-- Calendar will be populated by JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Leaves Tab -->
<div id="leaves" class="tab-content">
    <div class="card">
        <div class="card-header">
            <h2>Leave Balance</h2>
        </div>
        <div class="card-content">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">18</div>
                    <div class="stat-label">Annual Leave</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">12</div>
                    <div class="stat-label">Sick Leave</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">5</div>
                    <div class="stat-label">Personal Leave</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">3</div>
                    <div class="stat-label">Used This Month</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h2>Apply for Leave</h2>
        </div>
        <div class="card-content">
            <form method="post" action="/team/apply-leave/">
                {% csrf_token %}
                <div class="form-grid">
                    <div class="form-group">
                        <label>Leave Type</label>
                        <select name="leave_type" required>
                            <option value="">Select Leave Type</option>
                            <option value="annual">Annual Leave</option>
                            <option value="sick">Sick Leave</option>
                            <option value="personal">Personal Leave</option>
                            <option value="emergency">Emergency Leave</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>From Date</label>
                        <input type="date" name="from_date" required>
                    </div>
                    
                    <div class="form-group">
                        <label>To Date</label>
                        <input type="date" name="to_date" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Reason</label>
                        <textarea name="reason" rows="3" placeholder="Reason for leave" required></textarea>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">Apply for Leave</button>
            </form>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h2>Leave History</h2>
        </div>
        <div class="card-content">
            <div class="leave-request">
                <div class="d-flex">
                    <div>
                        <strong>Annual Leave</strong><br>
                        <small>Oct 15, 2025 - Oct 17, 2025</small>
                    </div>
                    <span class="leave-status approved">Approved</span>
                </div>
            </div>
            
            <div class="leave-request">
                <div class="d-flex">
                    <div>
                        <strong>Sick Leave</strong><br>
                        <small>Oct 5, 2025</small>
                    </div>
                    <span class="leave-status pending">Pending</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showTab(tabName) {
    // Hide all tab contents
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(tab => tab.classList.remove('active'));
    
    // Remove active class from all tab links
    const tabLinks = document.querySelectorAll('.profile-tab');
    tabLinks.forEach(link => link.classList.remove('active'));
    
    // Show selected tab content
    document.getElementById(tabName).classList.add('active');
    
    // Add active class to clicked tab link
    event.target.classList.add('active');
}

// Generate attendance calendar
function generateAttendanceCalendar() {
    const calendar = document.getElementById('attendanceCalendar');
    const daysInMonth = 30;
    
    for (let i = 1; i <= daysInMonth; i++) {
        const day = document.createElement('div');
        day.className = 'calendar-day';
        day.textContent = i;
        
        // Random attendance status for demo
        const rand = Math.random();
        if (rand > 0.9) {
            day.classList.add('absent');
        } else if (rand > 0.85) {
            day.classList.add('holiday');
        } else {
            day.classList.add('present');
        }
        
        calendar.appendChild(day);
    }
}

// Initialize calendar when page loads
document.addEventListener('DOMContentLoaded', generateAttendanceCalendar);
</script>
{% endblock %}