<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Meta Leads CRM{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/global.css' %}">
    {% block extra_css %}{% endblock %}
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }
        
        function toggleDropdown(event, dropdownId) {
            event.preventDefault();
            event.stopPropagation();
            
            const dropdown = document.getElementById(dropdownId);
            const toggle = event.currentTarget;
            
            // Close all other dropdowns
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                if (menu.id !== dropdownId) {
                    menu.classList.remove('show');
                }
            });
            document.querySelectorAll('.dropdown-toggle').forEach(t => {
                if (t !== toggle) {
                    t.classList.remove('open');
                }
            });
            
            // Toggle current dropdown
            dropdown.classList.toggle('show');
            toggle.classList.toggle('open');
        }
        
        // Initialize when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(event) {
                const sidebar = document.getElementById('sidebar');
                const menuBtn = document.querySelector('.mobile-menu-btn');
                
                // Handle mobile sidebar
                if (window.innerWidth <= 768 && 
                    !sidebar.contains(event.target) && 
                    !menuBtn.contains(event.target)) {
                    sidebar.classList.remove('open');
                }
                
                // Handle dropdowns - close if clicking outside
                if (!event.target.closest('.dropdown-nav')) {
                    document.querySelectorAll('.dropdown-menu').forEach(menu => {
                        menu.classList.remove('show');
                    });
                    document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
                        toggle.classList.remove('open');
                    });
                }
            });
        });
    </script>
</head>
<body>
    <div class="layout">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">Meta Leads CRM</div>
                <div class="sidebar-subtitle">Dashboard</div>
            </div>
            <div class="sidebar-nav">
                <div class="nav-item">
                    <a href="/dashboard/" class="nav-link {% if request.resolver_match.url_name == 'dashboard' or request.resolver_match.url_name == 'dashboard_explicit' %}active{% endif %}">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </div>
                <div class="nav-item dropdown-nav">
                    <a href="javascript:void(0)" class="nav-link dropdown-toggle {% if 'leads' in request.resolver_match.url_name and 'my_leads' not in request.resolver_match.url_name %}active{% endif %}" onclick="toggleDropdown(event, 'leads-dropdown')">
                        <i class="fas fa-users"></i>
                        <span>Leads</span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </a>
                    <div class="dropdown-menu" id="leads-dropdown">
                        <a href="/leads/" class="dropdown-item {% if request.resolver_match.url_name == 'leads_list' %}active{% endif %}">
                            <i class="fas fa-list"></i>
                            All Leads
                        </a>
                        <a href="/meta-leads/" class="dropdown-item {% if request.resolver_match.url_name == 'meta_leads' %}active{% endif %}">
                            <i class="fab fa-meta"></i>
                            Meta Leads
                        </a>
                        <a href="/google-leads/" class="dropdown-item {% if request.resolver_match.url_name == 'google_leads' %}active{% endif %}">
                            <i class="fab fa-google"></i>
                            Google Leads
                        </a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="/my-leads/" class="nav-link {% if request.resolver_match.url_name == 'my_leads' %}active{% endif %}">
                        <i class="fas fa-user"></i>
                        My Leads
                    </a>
                </div>
                <div class="nav-item dropdown-nav">
                    <a href="javascript:void(0)" class="nav-link dropdown-toggle {% if 'project' in request.resolver_match.url_name or 'form-mapping' in request.resolver_match.url_name %}active{% endif %}" onclick="toggleDropdown(event, 'projects-dropdown')">
                        <i class="fas fa-project-diagram"></i>
                        <span>Projects</span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </a>
                    <div class="dropdown-menu" id="projects-dropdown">
                        <a href="/projects/" class="dropdown-item {% if 'projects' in request.path and 'form-mapping' not in request.path %}active{% endif %}">
                            <i class="fas fa-list"></i>
                            All Projects
                        </a>
                        <a href="/form-mappings/" class="dropdown-item {% if 'form-mapping' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-diagram-project"></i>
                            Form Mappings
                        </a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="/whatsapp/" class="nav-link {% if 'whatsapp' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fab fa-whatsapp"></i>
                        WhatsApp
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/team/" class="nav-link {% if 'team' in request.resolver_match.url_name and 'profile' not in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fas fa-users-cog"></i>
                        Team
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/tagged-leads/" class="nav-link {% if 'tagged' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fas fa-tags"></i>
                        Smart Tags
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/ai/" class="nav-link {% if 'ai' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fas fa-robot"></i>
                        AI Assistant
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/leads-analytics/" class="nav-link {% if 'analytics' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fas fa-chart-bar"></i>
                        Analytics
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/interest-analytics/" class="nav-link {% if 'interest-analytics' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fas fa-heart"></i>
                        Interest Analytics
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/activity-dashboard/" class="nav-link {% if 'activity' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fas fa-history"></i>
                        Activity Log
                    </a>
                </div>
                <div class="nav-item dropdown-nav">
                    <a href="javascript:void(0)" class="nav-link dropdown-toggle {% if 'call' in request.resolver_match.url_name %}active{% endif %}" onclick="toggleDropdown(event, 'calling-dropdown')">
                        <i class="fas fa-phone"></i>
                        <span>Calling</span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </a>
                    <div class="dropdown-menu" id="calling-dropdown">
                        <a href="/call-panel/" class="dropdown-item {% if 'call-panel' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-phone"></i>
                            Call Panel
                        </a>
                        <a href="/call-analytics/" class="dropdown-item {% if 'call-analytics' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-phone-volume"></i>
                            IVR Panel
                        </a>
                        <a href="/bulk-call-panel/" class="dropdown-item {% if 'bulk-call-panel' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-phone-alt"></i>
                            Bulk Call Panel
                        </a>
                        <a href="/auto-call-config/" class="dropdown-item {% if 'auto-call-config' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-cog"></i>
                            Auto Call Config
                        </a>
                        <a href="/bulk-call-upload/" class="dropdown-item {% if 'bulk-call-upload' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-upload"></i>
                            Bulk Call Upload
                        </a>
                        <a href="/call-history/upload/" class="dropdown-item {% if 'call-history' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-file-excel"></i>
                            Call History Upload
                        </a>
                    </div>
                </div>
                {% if user.is_staff or request.session.team_member_name == 'ADMIN USER' %}
                <div class="nav-item">
                    <a href="/bookings/" class="nav-link {% if 'booking' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fas fa-building"></i>
                        United Network Bookings
                    </a>
                </div>
                {% endif %}
                <div class="nav-item">
                    <a href="/team/profile/" class="nav-link {% if 'profile' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fas fa-user-circle"></i>
                        My Profile
                    </a>
                </div>
                {% if user.is_staff or request.session.team_member_name == 'ADMIN USER' %}
                <div class="nav-item">
                    <a href="/google-sheets/" class="nav-link {% if 'google_sheets' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fab fa-google"></i>
                        Google Sheets
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/integrations/" class="nav-link {% if 'integration' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fas fa-cogs"></i>
                        Integrations
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/call-reports/upload/" class="nav-link {% if 'call-report' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fas fa-file-excel"></i>
                        Call Reports
                    </a>
                </div>
                {% endif %}
                <div class="nav-item">
                    <a href="/team/logout/" class="nav-link">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="main-content">
            <div class="top-header">
                <div class="d-flex align-items-center gap-2">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title">{% block page_title %}Dashboard{% endblock %}</h1>
                </div>
                <div class="user-info">
                    <div class="user-avatar">
                        {% if request.session.team_member_name %}
                            {{ request.session.team_member_name|first|upper }}
                        {% else %}
                            A
                        {% endif %}
                    </div>
                    <span>
                        Welcome, 
                        {% if request.session.team_member_name %}
                            {{ request.session.team_member_name }}
                        {% else %}
                            Admin
                        {% endif %}
                    </span>
                </div>
            </div>
            
            <div class="content-area">
                {% block content %}{% endblock %}
            </div>
        </div>
    </div>
    
    <script>
        {% block extra_js %}{% endblock %}
    </script>
</body>
</html>